import { Meta, Canvas } from '@storybook/addon-docs/blocks';

<Meta title="Home" />

# H5Web Component Library

[H5Web](https://github.com/silx-kit/h5web) is a web-based viewer to explore HDF5 files. It is built with React and uses
[react-three-fiber](https://github.com/react-spring/react-three-fiber) for visualizations.

This library provides data visualization components and utilities from H5Web for use in other front-end web applications.

The components are organised in two categories:

- ðŸŽ¨ **Visualizations**: the top-level visualization components â€” i.e. the components you will most likely need.
- ðŸ§± **Building Blocks**: the low-level components used by the visualization components â€” for advanced uses only.

## Getting started

1. Make you sure you have `react` and `react-dom` v16 or greater installed.
1. Install the library:

   ```bash
   npm install @h5web/lib
   ```

1. Import and use a visualization component:

   ```tsx
   import { ScalarVis } from '@h5web/lib';

   // ...

   <ScalarVis value={1024} />;
   ```

1. Other visualization components expect to receive an `ndarray` and a domain as props.

   1. Install `ndarray` and its corresponding types package (if you use TypeScript):

      ```bash
      npm install ndarray
      npm install --save-dev @types/ndarray
      ```

   1. Pass an `ndarray` and domain to the visualization:

      ```tsx
      import ndarray from 'ndarray';
      import { HeatmapVis, findDomain } from '@h5web/lib';

      // Source 2D array
      const values = [
        [0, 1, 2],
        [3, 4, 5],
      ];

      // Flatten array
      const flatValues: number[] = values.flat(Infinity);

      // Convert to ndarray and find domain
      const dataArray = ndarray<number>(flatValues, [2, 3]);
      const domain = findDomain(flatValues);

      // ...

      <HeatmapVis dataArray={dataArray} domain={domain} />;
      ```

1. Configure the visualization:

   ```tsx
   import { HeatmapVis, findDomain, ScaleType } from '@h5web/lib';

   // ...

   <HeatmapVis
     dataArray={dataArray}
     domain={domain}
     colorMap="Inferno"
     scaleType={ScaleType.Log}
     showLoader={false}
     ...
   />;
   ```

## Mock data

The library exposes mock metadata, values and utilities for testing purposes:

```ts
import { mockMetadata, mockValues, getMockDatasetDims } from '@h5web/lib';

const values = mockValues.twoD.flat(Infinity) as number[];
const dataArray = ndarray<number>(values, getMockDatasetDims('twoD'));
```

## Utilities

The library exposes a number of utility functions, which are documented below, as well as all the enums and types used by these utility functions.
If you use only the top-level visualization components, the only utilities you need are `findDomain` and/or `useDomain`.

- **`getDomain(values: number[], scaleType: ScaleType = ScaleType.Linear): Domain | undefined`** - Find the min and max values contained in a flat array of numbers. If `scaleType` is `ScaleType.Log` and the domain crosses zero, clamp the min to the first positive value or return `undefined` if the domain is not supported (i.e. `[-x, 0]`).
- **`useDomain(...args): Domain | undefined`** - Memoised React hook wrapper of `getDomain`.
- **`extendDomain(bareDomain: Domain, extendFactor: number, isLog?: boolean): Domain`** - Extend a domain by a given factor.
- **`computeVisSize(availableSize: Size, aspectRatio?: number): Size | undefined`** - Compute the optimal size for a visualization to fill the available space given an optional aspect ratio.
- **`getDims(dataArray: DataArray): Dims`** - Get the dimensions of a `ndarray` as a `{ rows, cols }` object.
- **`generateCSSLinearGradient(interpolator: D3Interpolator, direction: 'top' | 'bottom' | 'right' | 'left'): string`** - Generate a CSS linear gradient for a given D3 interpolator, to be used as `background-image`.
